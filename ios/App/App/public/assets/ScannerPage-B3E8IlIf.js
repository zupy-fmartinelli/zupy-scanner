import{a as f,u as b,d as j,e as S,r as t,i as y,y as c,j as e}from"./main-C-q4ut4N.js";import{c as N,r as w,s as v,S as C}from"./ScannerComponent-9Df4dkJ1.js";import{M as P}from"./MainLayout-BTgi3f_k.js";import"./pwa-scanner-branco-oh03E7i6.js";function H(){const a=f(),{userData:k,scannerData:E}=b(),{isProcessing:o,processScan:m,currentScan:l}=j(),{isOnline:h,pendingCount:R}=S(),[g,d]=t.useState(!1),[i,s]=t.useState("idle");t.useEffect(()=>{l&&l.processed&&a("/result")},[l,a]),t.useEffect(()=>{i==="idle"&&(console.log("ScannerPage mounted, attempting to start scan automatically."),s("initializing"),u())},[]);const u=async()=>{try{if(y()){if(!await N()&&!await w()){c.error("Camera permission is required for scanning");return}s("scanning");const n=await v();n?(s("processing"),await m(n)):s("idle")}else d(!0),s("scanning")}catch(r){c.error(r.message||"Failed to start scanner"),console.error("Scanner error:",r),s("idle")}},p=async r=>{d(!1),s("processing"),c.info("QR Code detectado! Processando...",{autoClose:1500,position:"top-center",hideProgressBar:!1});try{const n=await m(r);console.log("Scan processado com sucesso:",n),n&&n.processed?setTimeout(()=>{a("/result")},300):h||(c.warning("Você está offline. O scan será processado quando estiver online."),a("/result"))}catch(n){c.error(n.message||"Falha ao processar QR code"),console.error("Erro no processamento:",n),s("idle")}},x=()=>{a("/history")};return e.jsxs(P,{title:"Scanner",activeMenu:"scanner",children:[e.jsx("div",{className:"container py-4",children:e.jsx("div",{className:"row justify-content-center",children:e.jsx("div",{className:"col-md-8 col-lg-6",children:g?e.jsx("div",{className:"card bg-dark border-0 mb-4 shadow",children:e.jsx("div",{className:"card-body p-0",children:e.jsx(C,{onQrScanned:p,onClose:()=>{d(!1),s("idle")}})})}):e.jsx("div",{className:"text-center py-5 my-4 bg-dark rounded shadow-sm",children:e.jsxs("div",{className:"d-flex flex-column align-items-center",children:[e.jsx("div",{className:"scanner-icon-circle mb-4",children:e.jsx("i",{className:"bi bi-qr-code-scan fs-1"})}),e.jsx("h2",{className:"h4 mb-4 text-white",children:"Escaneie um QR Code"}),e.jsx("button",{className:"btn btn-primary btn-lg px-5 py-3 mb-3",onClick:u,disabled:o||i!=="idle",children:i==="processing"||o?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"}),"Processando..."]}):i==="scanning"?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-grow spinner-grow-sm me-2",role:"status","aria-hidden":"true"}),"Escaneando..."]}):"Iniciar Scanner"}),e.jsxs("button",{className:"btn btn-outline-light",onClick:x,disabled:o,children:[e.jsx("i",{className:"bi bi-clock-history me-2"}),"Histórico de scans"]})]})})})})}),e.jsx("style",{jsx:!0,children:`
        .scanner-icon-circle {
          width: 80px;
          height: 80px;
          border-radius: 50%;
          background-color: #5c2d91;
          display: flex;
          align-items: center;
          justify-content: center;
          color: white;
        }
      `})]})}export{H as default};
