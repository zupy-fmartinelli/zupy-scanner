import{a as f,u as b,d as j,e as S,r as d,j as s,y as c,i as y}from"./main-CIC-T_B5.js";import{S as N,c as w,r as v,s as C}from"./ScannerComponent-Csi0myA0.js";import{M as k}from"./MainLayout-vdxS2fs_.js";import"./pwa-scanner-branco-oh03E7i6.js";function H(){const a=f(),{userData:P,scannerData:R}=b(),{isProcessing:i,processScan:m,currentScan:o}=j(),{isOnline:u,pendingCount:E}=S(),[h,t]=d.useState(!1),[l,n]=d.useState("idle");d.useEffect(()=>{o&&o.processed&&a("/result")},[o,a]);const p=async()=>{try{if(y()){if(!await w()&&!await v()){c.error("Camera permission is required for scanning");return}n("scanning");const e=await C();e?(n("processing"),await m(e)):n("idle")}else t(!0),n("scanning")}catch(r){c.error(r.message||"Failed to start scanner"),console.error("Scanner error:",r),n("idle")}},g=async r=>{t(!1),n("processing"),c.info("QR Code detectado! Processando...",{autoClose:1500,position:"top-center",hideProgressBar:!1});try{const e=await m(r);console.log("Scan processado com sucesso:",e),e&&e.processed?setTimeout(()=>{a("/result")},300):u||(c.warning("Você está offline. O scan será processado quando estiver online."),a("/result"))}catch(e){c.error(e.message||"Falha ao processar QR code"),console.error("Erro no processamento:",e),n("idle")}},x=()=>{a("/history")};return s.jsxs(k,{title:"Scanner",activeMenu:"scanner",children:[s.jsx("div",{className:"container py-4",children:s.jsx("div",{className:"row justify-content-center",children:s.jsx("div",{className:"col-md-8 col-lg-6",children:h?s.jsx("div",{className:"card bg-dark border-0 mb-4 shadow",children:s.jsx("div",{className:"card-body p-0",children:s.jsx(N,{onQrScanned:g,onClose:()=>{t(!1),n("idle")}})})}):s.jsx("div",{className:"text-center py-5 my-4 bg-dark rounded shadow-sm",children:s.jsxs("div",{className:"d-flex flex-column align-items-center",children:[s.jsx("div",{className:"scanner-icon-circle mb-4",children:s.jsx("i",{className:"bi bi-qr-code-scan fs-1"})}),s.jsx("h2",{className:"h4 mb-4 text-white",children:"Escaneie um QR Code"}),s.jsx("button",{className:"btn btn-primary btn-lg px-5 py-3 mb-3",onClick:p,disabled:i||l!=="idle",children:l==="processing"||i?s.jsxs(s.Fragment,{children:[s.jsx("span",{className:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"}),"Processando..."]}):l==="scanning"?s.jsxs(s.Fragment,{children:[s.jsx("span",{className:"spinner-grow spinner-grow-sm me-2",role:"status","aria-hidden":"true"}),"Escaneando..."]}):"Iniciar Scanner"}),s.jsxs("button",{className:"btn btn-outline-light",onClick:x,disabled:i,children:[s.jsx("i",{className:"bi bi-clock-history me-2"}),"Histórico de scans"]})]})})})})}),s.jsx("style",{jsx:!0,children:`
        .scanner-icon-circle {
          width: 80px;
          height: 80px;
          border-radius: 50%;
          background-color: #5c2d91;
          display: flex;
          align-items: center;
          justify-content: center;
          color: white;
        }
      `})]})}export{H as default};
