import{a as y,u as w,e as S,r,j as e,y as a,c as A,i as k,l as C}from"./main-C91a_6nM.js";import{S as I}from"./SimpleLayout-DQJcr4zb.js";import"./PwaInstallPrompt-DGbz7qAF.js";import"./pwa-scanner-branco-oh03E7i6.js";function D(){const b=y(),{userData:i,scannerData:n,logout:p}=w(),{isOnline:t,syncData:u,pendingCount:o}=S(),[l,j]=r.useState(""),[P,O]=r.useState(!1),[m,x]=r.useState(!1),[h,N]=r.useState({}),[f,c]=r.useState(!1);r.useEffect(()=>{(async()=>{const d=await A();j(d),N({platform:C(),isNative:k(),userAgent:navigator.userAgent,onLine:navigator.onLine})})()},[]);const g=async()=>{if(!t){a.error("Você está offline. Não é possível sincronizar.");return}try{x(!0);const s=await u();s.synced>0?a.success(`${s.synced} operações sincronizadas com sucesso`):s.pending===0&&s.failed===0?a.info("Nenhuma operação pendente para sincronização"):s.failed>0&&a.error(`${s.failed} operações com falha na sincronização`)}catch(s){a.error("Erro ao sincronizar dados"),console.error("Sync error:",s)}finally{x(!1)}},v=async()=>{await p(),c(!1),b("/auth")};return e.jsxs(I,{title:"Configurações",activeMenu:"settings",children:[e.jsx("div",{className:"container py-4",children:e.jsx("div",{className:"row justify-content-center",children:e.jsxs("div",{className:"col-12",children:[e.jsxs("div",{className:"card mb-4 bg-dark border-secondary shadow-sm",children:[" ",e.jsxs("div",{className:"card-body text-white",children:[" ",e.jsx("h5",{className:"card-title mb-3",children:"Informações do Scanner"}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label text-muted small",children:"Nome do Scanner"}),e.jsxs("div",{className:"form-control-plaintext text-white",children:[" ",(n==null?void 0:n.name)||"Scanner não identificado"]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label text-muted small",children:"ID do Scanner"}),e.jsxs("div",{className:"form-control-plaintext font-monospace small text-white-50",children:[" ",(n==null?void 0:n.id)||"N/A"]})]}),e.jsxs("div",{className:"mb-0",children:[e.jsx("label",{className:"form-label text-muted small",children:"Operador"}),e.jsxs("div",{className:"form-control-plaintext text-white",children:[" ",(i==null?void 0:i.name)||"Usuário não identificado"]})]})]})]}),e.jsxs("div",{className:"card mb-4 bg-dark border-secondary shadow-sm",children:[" ",e.jsxs("div",{className:"card-body text-white",children:[" ",e.jsx("h5",{className:"card-title mb-3",children:"Conexão de API"}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"d-flex align-items-center mb-2",children:[e.jsx("span",{className:`badge me-2 ${t?"bg-success":"bg-danger"}`,children:t?"Conectado":"Desconectado"}),e.jsx("span",{className:"text-muted",children:"Status da API"})]}),e.jsxs("div",{className:"alert alert-secondary",children:[e.jsx("i",{className:"bi bi-info-circle me-2"}),e.jsxs("small",{children:["Endpoint: ",e.jsx("span",{className:"font-monospace",children:l||"https://api.zupy.com"})]})]})]}),e.jsxs("button",{className:"btn btn-primary",onClick:async()=>{try{if(!t){a.warning("Você está offline. Não é possível testar a conexão.");return}a.info("Testando conexão com a API...");const s=await fetch(`${l}/scanner/api/v1/ping/`,{method:"GET",headers:{Accept:"application/json"}});s.ok?a.success("Conexão com a API estabelecida com sucesso!"):a.error(`Erro ao conectar com a API: ${s.status} ${s.statusText}`)}catch(s){a.error(`Falha ao conectar com a API: ${s.message}`)}},children:[e.jsx("i",{className:"bi bi-arrow-repeat me-2"}),"Testar Conexão"]})]})]}),e.jsxs("div",{className:"card mb-4 bg-dark border-secondary shadow-sm",children:[" ",e.jsxs("div",{className:"card-body text-white",children:[" ",e.jsx("h5",{className:"card-title mb-3",children:"Sincronização"}),e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("span",{className:`badge me-2 ${t?"bg-success":"bg-danger"}`,children:t?"Online":"Offline"}),e.jsx("span",{children:"Status da Conexão"})]}),o>0&&e.jsxs("div",{className:"text-warning small mt-1",children:[e.jsx("i",{className:"bi bi-exclamation-triangle me-1"}),o," ",o===1?"operação pendente":"operações pendentes"]})]}),e.jsx("button",{className:"btn btn-primary",onClick:g,disabled:!t||m||o===0,children:m?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"}),"Sincronizando..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"bi bi-arrow-repeat me-2"}),"Sincronizar Agora"]})})]}),e.jsxs("div",{className:"form-text text-white-50",children:[" ","A sincronização automática ocorre a cada 60 segundos quando você está online."]})]})]}),e.jsxs("div",{className:"card mb-4 bg-dark border-secondary shadow-sm",children:[" ",e.jsxs("div",{className:"card-body text-white",children:[" ",e.jsx("h5",{className:"card-title mb-3",children:"Depuração de API"}),e.jsx("button",{className:"btn btn-sm btn-outline-secondary",type:"button","data-bs-toggle":"collapse","data-bs-target":"#apiDebug",children:"Mostrar Endpoints"}),e.jsx("div",{className:"collapse mt-3",id:"apiDebug",children:e.jsxs("div",{className:"card card-body bg-light text-dark",children:[" ",e.jsx("h6",{className:"mb-3",children:"Endpoints do Scanner"}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label text-muted small",children:"Autenticação (POST)"}),e.jsxs("div",{className:"input-group mb-1",children:[e.jsx("span",{className:"input-group-text font-monospace small",children:l}),e.jsx("input",{type:"text",className:"form-control font-monospace small",value:"/scanner/api/v1/auth/",readOnly:!0})]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label text-muted small",children:"Validação de Token (GET)"}),e.jsxs("div",{className:"input-group mb-1",children:[e.jsx("span",{className:"input-group-text font-monospace small",children:l}),e.jsx("input",{type:"text",className:"form-control font-monospace small",value:"/scanner/api/v1/auth-token/",readOnly:!0})]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label text-muted small",children:"Logout (POST)"}),e.jsxs("div",{className:"input-group mb-1",children:[e.jsx("span",{className:"input-group-text font-monospace small",children:l}),e.jsx("input",{type:"text",className:"form-control font-monospace small",value:"/scanner/api/v1/logout/",readOnly:!0})]})]}),e.jsx("button",{className:"btn btn-sm btn-primary",onClick:async()=>{try{const d=(await fetch(`${l}/api/v1/scanner/auth/`,{method:"OPTIONS"})).status;a.info(`Endpoint respondeu com status: ${d}`)}catch(s){a.error(`Erro ao testar endpoint: ${s.message}`)}},children:"Testar Conectividade (OPTIONS)"})]})})]})]}),e.jsxs("div",{className:"card mb-4 bg-dark border-secondary shadow-sm",children:[" ",e.jsxs("div",{className:"card-body text-white",children:[" ",e.jsx("h5",{className:"card-title mb-3",children:"Informações do App"}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label text-muted small",children:"Versão"}),e.jsx("div",{className:"form-control-plaintext text-white",children:"1.0.0"})," "]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label text-muted small",children:"Plataforma"}),e.jsxs("div",{className:"form-control-plaintext text-white",children:[" ",h.platform||"Desconhecida"]})]}),e.jsxs("div",{className:"mb-0",children:[e.jsx("button",{className:"btn btn-sm btn-outline-secondary",type:"button","data-bs-toggle":"collapse","data-bs-target":"#appDetails",children:"Detalhes Técnicos"}),e.jsx("div",{className:"collapse mt-3",id:"appDetails",children:e.jsxs("div",{className:"card card-body bg-light text-dark",children:[" ",e.jsx("pre",{className:"mb-0 small",style:{whiteSpace:"pre-wrap"},children:JSON.stringify(h,null,2)})]})})]})]})]}),e.jsx("div",{className:"d-grid gap-2 mb-5",children:e.jsxs("button",{className:"btn btn-danger",onClick:()=>c(!0),children:[e.jsx("i",{className:"bi bi-box-arrow-right me-2"}),"Sair do Aplicativo"]})})]})})}),f&&e.jsx("div",{className:"modal fade show",style:{display:"block",backgroundColor:"rgba(0, 0, 0, 0.5)"},tabIndex:"-1",children:e.jsx("div",{className:"modal-dialog modal-dialog-centered",children:e.jsxs("div",{className:"modal-content bg-dark text-white border-secondary",children:[e.jsxs("div",{className:"modal-header border-secondary",children:[e.jsx("h5",{className:"modal-title",children:"Confirmação"}),e.jsx("button",{type:"button",className:"btn-close btn-close-white",onClick:()=>c(!1)})]}),e.jsxs("div",{className:"modal-body",children:[e.jsx("p",{children:"Tem certeza que deseja sair do aplicativo?"}),!t&&e.jsx("div",{className:"alert alert-warning",role:"alert",children:e.jsxs("small",{children:[e.jsx("i",{className:"bi bi-exclamation-triangle me-2"}),"Você está offline. Dados não sincronizados podem ser perdidos."]})})]}),e.jsxs("div",{className:"modal-footer border-secondary",children:[e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:()=>c(!1),children:"Cancelar"}),e.jsx("button",{type:"button",className:"btn btn-danger",onClick:v,children:"Sair"})]})]})})})]})}export{D as default};
