import{u as N,e as f,r as t,j as e,y as a,c as g,i as v,l as y}from"./main-8IGYUPaQ.js";import{M as S}from"./MainLayout-BTQmRPiH.js";import"./pwa-scanner-branco-oh03E7i6.js";function T(){const{userData:i,scannerData:l,logout:p}=N(),{isOnline:n,syncData:h,pendingCount:c}=f(),[r,b]=t.useState(""),[w,A]=t.useState(!1),[d,m]=t.useState(!1),[x,u]=t.useState({});t.useEffect(()=>{(async()=>{const o=await g();b(o),u({platform:y(),isNative:v(),userAgent:navigator.userAgent,onLine:navigator.onLine})})()},[]);const j=async()=>{if(!n){a.error("Você está offline. Não é possível sincronizar.");return}try{m(!0);const s=await h();s.synced>0?a.success(`${s.synced} operações sincronizadas com sucesso`):s.pending===0&&s.failed===0?a.info("Nenhuma operação pendente para sincronização"):s.failed>0&&a.error(`${s.failed} operações com falha na sincronização`)}catch(s){a.error("Erro ao sincronizar dados"),console.error("Sync error:",s)}finally{m(!1)}};return e.jsx(S,{title:"Configurações",activeMenu:"settings",children:e.jsx("div",{className:"container py-4",children:e.jsx("div",{className:"row justify-content-center",children:e.jsxs("div",{className:"col-md-8 col-lg-6",children:[e.jsx("div",{className:"card mb-4 bg-white border-0 shadow-sm",children:e.jsxs("div",{className:"card-body",children:[e.jsx("h5",{className:"card-title mb-3",children:"Informações do Scanner"}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label text-muted small",children:"Nome do Scanner"}),e.jsx("div",{className:"form-control-plaintext",children:(l==null?void 0:l.name)||"Scanner não identificado"})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label text-muted small",children:"ID do Scanner"}),e.jsx("div",{className:"form-control-plaintext font-monospace small",children:(l==null?void 0:l.id)||"N/A"})]}),e.jsxs("div",{className:"mb-0",children:[e.jsx("label",{className:"form-label text-muted small",children:"Operador"}),e.jsx("div",{className:"form-control-plaintext",children:(i==null?void 0:i.name)||"Usuário não identificado"})]})]})}),e.jsx("div",{className:"card mb-4 border-0 shadow-sm",children:e.jsxs("div",{className:"card-body",children:[e.jsx("h5",{className:"card-title mb-3",children:"Conexão de API"}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"d-flex align-items-center mb-2",children:[e.jsx("span",{className:`badge me-2 ${n?"bg-success":"bg-danger"}`,children:n?"Conectado":"Desconectado"}),e.jsx("span",{className:"text-muted",children:"Status da API"})]}),e.jsxs("div",{className:"alert alert-secondary",children:[e.jsx("i",{className:"bi bi-info-circle me-2"}),e.jsxs("small",{children:["Endpoint: ",e.jsx("span",{className:"font-monospace",children:r||"https://api.zupy.com"})]})]})]}),e.jsxs("button",{className:"btn btn-primary",onClick:async()=>{try{if(!n){a.warning("Você está offline. Não é possível testar a conexão.");return}a.info("Testando conexão com a API...");const s=await fetch(`${r}/scanner/api/v1/ping/`,{method:"GET",headers:{Accept:"application/json"}});s.ok?a.success("Conexão com a API estabelecida com sucesso!"):a.error(`Erro ao conectar com a API: ${s.status} ${s.statusText}`)}catch(s){a.error(`Falha ao conectar com a API: ${s.message}`)}},children:[e.jsx("i",{className:"bi bi-arrow-repeat me-2"}),"Testar Conexão"]})]})}),e.jsx("div",{className:"card mb-4 bg-white border-0 shadow-sm",children:e.jsxs("div",{className:"card-body",children:[e.jsx("h5",{className:"card-title mb-3",children:"Sincronização"}),e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("span",{className:`badge me-2 ${n?"bg-success":"bg-danger"}`,children:n?"Online":"Offline"}),e.jsx("span",{children:"Status da Conexão"})]}),c>0&&e.jsxs("div",{className:"text-warning small mt-1",children:[e.jsx("i",{className:"bi bi-exclamation-triangle me-1"}),c," ",c===1?"operação pendente":"operações pendentes"]})]}),e.jsx("button",{className:"btn btn-primary",onClick:j,disabled:!n||d||c===0,children:d?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"}),"Sincronizando..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"bi bi-arrow-repeat me-2"}),"Sincronizar Agora"]})})]}),e.jsx("div",{className:"form-text",children:"A sincronização automática ocorre a cada 60 segundos quando você está online."})]})}),e.jsx("div",{className:"card mb-4 bg-white border-0 shadow-sm",children:e.jsxs("div",{className:"card-body",children:[e.jsx("h5",{className:"card-title mb-3",children:"Depuração de API"}),e.jsx("button",{className:"btn btn-sm btn-outline-secondary",type:"button","data-bs-toggle":"collapse","data-bs-target":"#apiDebug",children:"Mostrar Endpoints"}),e.jsx("div",{className:"collapse mt-3",id:"apiDebug",children:e.jsxs("div",{className:"card card-body bg-light",children:[e.jsx("h6",{className:"mb-3",children:"Endpoints do Scanner"}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label text-muted small",children:"Autenticação (POST)"}),e.jsxs("div",{className:"input-group mb-1",children:[e.jsx("span",{className:"input-group-text font-monospace small",children:r}),e.jsx("input",{type:"text",className:"form-control font-monospace small",value:"/scanner/api/v1/auth/",readOnly:!0})]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label text-muted small",children:"Validação de Token (GET)"}),e.jsxs("div",{className:"input-group mb-1",children:[e.jsx("span",{className:"input-group-text font-monospace small",children:r}),e.jsx("input",{type:"text",className:"form-control font-monospace small",value:"/scanner/api/v1/auth-token/",readOnly:!0})]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label text-muted small",children:"Logout (POST)"}),e.jsxs("div",{className:"input-group mb-1",children:[e.jsx("span",{className:"input-group-text font-monospace small",children:r}),e.jsx("input",{type:"text",className:"form-control font-monospace small",value:"/scanner/api/v1/logout/",readOnly:!0})]})]}),e.jsx("button",{className:"btn btn-sm btn-primary",onClick:async()=>{try{const o=(await fetch(`${r}/api/v1/scanner/auth/`,{method:"OPTIONS"})).status;a.info(`Endpoint respondeu com status: ${o}`)}catch(s){a.error(`Erro ao testar endpoint: ${s.message}`)}},children:"Testar Conectividade (OPTIONS)"})]})})]})}),e.jsx("div",{className:"card mb-4 bg-white border-0 shadow-sm",children:e.jsxs("div",{className:"card-body",children:[e.jsx("h5",{className:"card-title mb-3",children:"Informações do App"}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label text-muted small",children:"Versão"}),e.jsx("div",{className:"form-control-plaintext",children:"1.0.0"})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label text-muted small",children:"Plataforma"}),e.jsx("div",{className:"form-control-plaintext",children:x.platform||"Desconhecida"})]}),e.jsxs("div",{className:"mb-0",children:[e.jsx("button",{className:"btn btn-sm btn-outline-secondary",type:"button","data-bs-toggle":"collapse","data-bs-target":"#appDetails",children:"Detalhes Técnicos"}),e.jsx("div",{className:"collapse mt-3",id:"appDetails",children:e.jsx("div",{className:"card card-body bg-light",children:e.jsx("pre",{className:"mb-0 small",style:{whiteSpace:"pre-wrap"},children:JSON.stringify(x,null,2)})})})]})]})}),e.jsx("div",{className:"d-grid gap-2 mb-4",children:e.jsxs("button",{className:"btn btn-danger",onClick:()=>{confirm("Tem certeza que deseja sair do aplicativo?")&&p()},children:[e.jsx("i",{className:"bi bi-box-arrow-right me-2"}),"Sair do Aplicativo"]})})]})})})})}export{T as default};
